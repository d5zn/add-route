# Финальное исправление для Railway

## Проблема

Билд на Railway падает с ошибкой разрешения модулей:
```
Module not found: Can't resolve '@/lib/polyline'
Module not found: Can't resolve '@/lib/strava'
Module not found: Can't resolve '@/lib/validation'
```

## Решения

### 1. Обновлена конфигурация

- ✅ `tsconfig.json` - правильные `baseUrl` и `paths`
- ✅ `jsconfig.json` - дублирует конфигурацию для Next.js
- ✅ `next.config.ts` - включен `output: 'standalone'` для Docker

### 2. Создан Dockerfile

Создан явный `Dockerfile` для Railway, который:
- Правильно копирует все файлы
- Генерирует Prisma Client
- Собирает Next.js приложение
- Использует standalone output

### 3. Обновлен nixpacks.toml

Добавлены проверки конфигурационных файлов во время билда для диагностики.

### 4. Создан .dockerignore

Исключены ненужные файлы из Docker образа.

## Варианты деплоя

### Вариант 1: Использовать Dockerfile (рекомендуется)

Railway автоматически обнаружит `Dockerfile` и использует его вместо nixpacks.

**Преимущества:**
- Полный контроль над процессом билда
- Гарантированная правильная настройка окружения
- Лучшая диагностика проблем

### Вариант 2: Использовать nixpacks

Если Railway использует nixpacks, убедитесь что:
1. Все файлы закоммичены
2. `tsconfig.json` и `jsconfig.json` присутствуют
3. Переменные окружения установлены

## Проверка перед деплоем

1. ✅ Локальный билд проходит: `npm run build`
2. ✅ Все файлы закоммичены
3. ✅ `tsconfig.json` содержит правильные `paths`
4. ✅ `jsconfig.json` присутствует
5. ✅ DATABASE_URL установлен в Railway

## Если проблема сохраняется

1. **Проверьте логи билда на Railway:**
   - Railway Dashboard → Deployments → View Logs
   - Найдите конкретную ошибку

2. **Убедитесь, что Railway использует Dockerfile:**
   - В настройках проекта проверьте, что Dockerfile обнаружен
   - Или явно укажите использование Dockerfile

3. **Проверьте переменные окружения:**
   - Все переменные должны быть установлены ДО билда
   - DATABASE_URL должен быть доступен

4. **Альтернатива: использовать относительные пути (временно):**
   Если ничего не помогает, можно временно заменить алиасы на относительные пути, но это не рекомендуется.

## Текущее состояние

- ✅ Dockerfile создан
- ✅ Конфигурация обновлена
- ✅ Локальный билд проходит
- ⏳ Ожидается проверка на Railway

